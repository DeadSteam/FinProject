## Страница «Тренды» — руководство для аналитиков

### Что показывает страница
- «Динамика показателей» — график изменения выбранной метрики во времени.
- «Статистические показатели» — сводные значения по видимой серии:
  - Текущее значение: значение последнего периода на графике.
  - Среднее: среднее арифметическое видимых значений.
  - Общий тренд: изменение между первым и последним видимыми периодами, в % от первого (если первый = 0, показывается 0%).
  - Волатильность: стандартное отклонение помесячной доходности (изменения относительно предыдущего периода), в процентах. Защищено от деления на 0.
- «Прогнозирование» — простая линейная экстраполяция по видимым точкам:
  - Прогноз на следующий период.
  - Наклон тренда, максимум/минимум ряда, индикатор уверенности.

### Источники данных и метрики
- Факт (actual/fact): фактические суммы.
- План (plan): плановые суммы.
- Отклонение: факт − план (на сервере уже считается, но дополнительно защищено от NaN).
- % выполнения: факт / план × 100% (защита от деления на 0).

### Временная агрегация
- По годам: агрегируется по годам.
- По кварталам: агрегация по кварталам Q1–Q4.
- По месяцам: показывает помесячные значения; для каждого года строится отдельная серия.

### Фильтры
- Годы: определяют какие серии отображаются.
- Метрики: определяют, какую величину рассчитывать и показывать на графике.
- Диапазон месяцев (только для «по месяцам»): выбирается стартовый и конечный месяц (1–12). Диапазон применяется ко всем выбранным годам.

### Форматирование
- Суммы: с пробелами-разделителями тысяч (локаль ru-RU).
- Проценты: 1 знак после запятой.
- Подсказки (tooltips): корректно форматируют числа и проценты, поддерживают строковые значения вида «1 234,5».

### Легенды и цвета
- Для месячного режима в сравнении выводится мини‑легенда цветов по годам.
- Цвета серий по годам фиксированы и повторяются циклически.

### Частые вопросы
- Почему тренд 0%? Первый видимый период равен 0 либо доступна только одна точка.
- Почему волатильность NaN? Исправлено: при нулевом/отсутствующем предыдущем значении используется 0, деления на 0 нет.

### Рекомендации по использованию
- Сравнивайте несколько лет в месячном режиме, чтобы увидеть сезонность.
- Для высокой волатильности рассмотрите «Скользящее среднее» для сглаживания краткосрочных колебаний.







