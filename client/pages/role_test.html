<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест авторизации и ролей</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 15px;
        }
        .card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .result {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            min-height: 50px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .links {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        .links a {
            padding: 10px 15px;
            background-color: #2196F3;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        .links a:hover {
            background-color: #0b7dda;
        }
    </style>
</head>
<body>
    <h1>Тест авторизации и ролей</h1>
    
    <div class="card">
        <h2>Токен авторизации</h2>
        <div class="result" id="tokenResult"></div>
    </div>
    
    <div class="card">
        <h2>Данные пользователя</h2>
        <button id="getUserBtn">Получить данные пользователя</button>
        <div class="result" id="userResult"></div>
    </div>
    
    <div class="card">
        <h2>Роль пользователя</h2>
        <button id="getRoleBtn">Получить роль</button>
        <div class="result" id="roleResult"></div>
    </div>
    
    <div class="card">
        <h2>Список ролей</h2>
        <button id="getRolesBtn">Получить все роли</button>
        <div class="result" id="rolesResult"></div>
    </div>
    
    <div class="card">
        <h2>Проверка доступа</h2>
        <button id="checkAccessBtn">Проверить доступ к админпанели</button>
        <div class="result" id="accessResult"></div>
    </div>
    
    <div class="links">
        <a href="/client/index.html">На главную</a>
        <a href="/client/pages/admin-dashboard.html">Админпанель</a>
        <a href="/client/pages/login.html">Страница входа</a>
    </div>
    
    <script type="module">
        import { getCurrentUser, getUserRole, getAllRoles, checkUserRole } from '../scripts/auth/auth_check.js';
        
        document.addEventListener('DOMContentLoaded', function() {
            // Отображаем информацию о токене
            const tokenElement = document.getElementById('tokenResult');
            const token = localStorage.getItem('accessToken');
            const tokenType = localStorage.getItem('tokenType');
            
            if (token) {
                tokenElement.textContent = `Тип: ${tokenType || 'Bearer'}\nТокен: ${token}`;
            } else {
                tokenElement.textContent = 'Токен не найден. Вы не авторизованы.';
            }
            
            // Получение данных пользователя
            document.getElementById('getUserBtn').addEventListener('click', async function() {
                const userResult = document.getElementById('userResult');
                userResult.textContent = 'Загрузка...';
                
                const userData = await getCurrentUser();
                if (userData) {
                    userResult.textContent = JSON.stringify(userData, null, 2);
                } else {
                    userResult.textContent = 'Не удалось получить данные пользователя';
                }
            });
            
            // Получение роли пользователя
            document.getElementById('getRoleBtn').addEventListener('click', async function() {
                const roleResult = document.getElementById('roleResult');
                roleResult.textContent = 'Загрузка...';
                
                const roleData = await getUserRole();
                if (roleData) {
                    roleResult.textContent = JSON.stringify(roleData, null, 2);
                } else {
                    roleResult.textContent = 'Не удалось получить роль пользователя';
                }
            });
            
            // Получение всех ролей
            document.getElementById('getRolesBtn').addEventListener('click', async function() {
                const rolesResult = document.getElementById('rolesResult');
                rolesResult.textContent = 'Загрузка...';
                
                const rolesData = await getAllRoles();
                if (rolesData) {
                    rolesResult.textContent = JSON.stringify(rolesData, null, 2);
                } else {
                    rolesResult.textContent = 'Не удалось получить список ролей (возможно, у вас нет прав администратора)';
                }
            });
            
            // Проверка доступа
            document.getElementById('checkAccessBtn').addEventListener('click', async function() {
                const accessResult = document.getElementById('accessResult');
                accessResult.textContent = 'Проверка доступа...';
                
                const hasAccess = await checkUserRole(['admin', 'manager']);
                if (hasAccess) {
                    accessResult.textContent = 'У вас есть доступ к админпанели';
                } else {
                    accessResult.textContent = 'У вас нет доступа к админпанели';
                }
            });
        });
    </script>
</body>
</html> 