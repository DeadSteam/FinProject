# Система миграций базы данных

## Обзор

Система миграций базы данных позволяет вносить изменения в структуру базы данных. Миграции реализованы как SQL-скрипты, которые последовательно применяются к базе данных. Каждая миграция имеет уникальный номер и название, что позволяет отслеживать порядок их применения.

## Расположение миграций

Все миграции находятся в директории `sql/migrations/`. Имена файлов миграций имеют формат:
```
NNN_название_миграции.sql
```
где NNN - это номер миграции (начиная с 001).

## Применение миграций

Для применения миграций доступны следующие инструменты:

### Bash скрипт (Linux/macOS)

```bash
./scripts/run_migrations.sh
```

### PowerShell скрипт (Windows)

```powershell
./scripts/run_migrations.ps1
```

### Python скрипт (кроссплатформенный)

```bash
python scripts/apply_migrations.py
```

## Структура миграции

Типичная миграция имеет следующую структуру:

```sql
-- Миграция: Описание цели миграции
-- Файл: NNN_название_миграции.sql

BEGIN;

-- SQL команды для внесения изменений

COMMIT;

-- Комментарии для отката миграции
/*
BEGIN;
-- SQL команды для отката изменений
COMMIT;
*/
```

## Создание новых миграций

Для создания новой миграции:

1. Создайте новый файл в директории `sql/migrations/`
2. Назовите файл в соответствии с форматом `NNN_название_миграции.sql`
3. Номер должен быть следующим после последней существующей миграции
4. Файл должен содержать SQL команды в рамках транзакции (BEGIN; ... COMMIT;)
5. По возможности добавьте команды для отката миграции в комментариях

## Список существующих миграций

| Номер | Название | Описание |
|-------|----------|----------|
| 001 | add_phone_number_to_users | Добавление поля телефона пользователя и индекса для него |

## Рекомендации

1. Всегда тестируйте миграции на тестовой базе данных перед применением их в продакшене.
2. Никогда не изменяйте уже примененные миграции - создавайте новые.
3. Документируйте изменения в этом файле.
4. Включайте команды для отката в комментариях к миграциям. 