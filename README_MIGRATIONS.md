# Управление миграциями базы данных с Alembic

В этом проекте используется Alembic для управления миграциями базы данных. Это позволяет отслеживать и применять изменения схемы базы данных в контролируемом порядке.

## Настройка

Alembic уже настроен в проекте. Основные файлы конфигурации:

- `alembic.ini` - главный файл конфигурации Alembic
- `alembic/env.py` - настройка окружения для миграций
- `alembic/versions/` - директория с файлами миграций

## Работа с миграциями

### Создание новой миграции

Для создания новой миграции на основе изменений в моделях SQLAlchemy запустите:

```bash
# Через командную строку
alembic revision --autogenerate -m "Описание миграции"

# Или используйте готовый скрипт (Windows)
create_migration.bat
```

Это создаст новый файл миграции в директории `alembic/versions/`.

### Применение миграций

Для применения всех неприменённых миграций выполните:

```bash
# Через командную строку
alembic upgrade head

# Или используйте готовый скрипт (Windows)
apply_migration.bat
```

### Откат миграций

Для отката последней миграции выполните:

```bash
alembic downgrade -1
```

Для отката до определенной версии:

```bash
alembic downgrade <revision_id>
```

### Просмотр текущей версии

Чтобы узнать текущую версию базы данных:

```bash
alembic current
```

### Просмотр истории миграций

Для просмотра истории миграций:

```bash
alembic history --verbose
```

## Важные замечания

1. Всегда создавайте резервную копию базы данных перед применением миграций в производственной среде.

2. Если в моделях добавлен новый класс, убедитесь, что он импортирован в `alembic/env.py`.

3. Миграции автоматически создаются на основе разницы между текущим состоянием базы данных и определениями моделей. Внимательно проверяйте сгенерированные файлы миграций перед их применением.

4. При работе в команде согласуйте стратегию работы с миграциями, чтобы избежать конфликтов.

## Устранение проблем

### Ошибка подключения к базе данных

Убедитесь, что база данных запущена и доступна. Проверьте настройки подключения в `alembic.ini` и `alembic/env.py`.

### Конфликты миграций

Если возникают конфликты миграций из-за параллельной работы нескольких разработчиков, может потребоваться ручное объединение файлов миграций или создание новой миграции, объединяющей изменения. 